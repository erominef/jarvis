User["ðŸ‘¤ User (Telegram)"]
    Bot["grammY Telegram Bot\n(interface/telegram.ts)"]
    Agent["Agent Loop\n(core/agent.ts)"]
    Classify["Classifier\nSIMPLE / STANDARD / REASONING\n+ needsTools gate"]
    Router["Router\n(core/router.ts)"]
    ToolReg["Tool Registry\n(tools/registry.ts)"]

    PC["Ubuntu PC â€” i7-6700\nOllama :11434\nqwen3:0.6b / 4b\nqwen2.5:7b"]
    Xeon["Xeon â€” 2Ã—X5670\nOllama :11434\nqwen3:14b\ndeepseek-r1:7b / 14b"]

    Tools["Tools"]
    WebFetch["web_fetch"]
    Shell["shell_run"]
    Memory["memory_read / write"]
    MCP["search_knowledge_base\n(MCP SSE client)"]
    KB["Montegallo KB\n(external MCP server)\n~5k document chunks"]
graph TD;   
    User -->|"message"| Bot
    Bot -->|"text + history"| Agent
    Agent --> Classify
    Classify -->|"tier + needsTools"| Router
    Router -->|"fast tasks"| PC
    Router -->|"deep reasoning"| Xeon
    Agent <-->|"tool calls"| ToolReg
    ToolReg --> Tools
    Tools --> WebFetch
    Tools --> Shell
    Tools --> Memory
    Tools --> MCP
    MCP -->|"SSE / JSON-RPC"| KB
    PC -->|"streamed tokens"| Agent
    Xeon -->|"streamed tokens"| Agent
    Agent -->|"response"| Bot
    Bot -->|"reply"| User

    style PC fill:#1e3a5f,color:#fff
    style Xeon fill:#3a1e5f,color:#fff
    style KB fill:#1e5f3a,color:#fff
    style User fill:#5f3a1e,color:#fff
```
